{"ast":null,"code":"var _jsxFileName = \"/home/dbws/projects/resume-maker/resume-react-ui/src/components/pages/price/checkoutForm.js\",\n    _s = $RefreshSig$(),\n    _s2 = $RefreshSig$();\n\nimport React, { useState, useEffect, useMemo } from \"react\"; // import { CardElement, useStripe, useElements } from \"@stripe/react-stripe-js\";\n\nimport API from \"../../../API/index\";\nimport { connect } from \"react-redux\";\nimport { useStripe, useElements, CardNumberElement, CardCvcElement, CardExpiryElement } from \"@stripe/react-stripe-js\";\nimport { setLocalStorageItem, getLocalStorageItem } from \"../../../utils/globals\";\nimport { auth } from \"../../../actions/user\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\n\nconst useOptions = () => {\n  _s();\n\n  // const fontSize = useResponsiveFontSize();\n  const options = useMemo(() => ({\n    style: {\n      base: {\n        // fontSize,\n        color: \"#424770\",\n        letterSpacing: \"0.025em\",\n        fontFamily: \"Source Code Pro, monospace\",\n        \"::placeholder\": {\n          color: \"#aab7c4\"\n        }\n      },\n      invalid: {\n        color: \"#9e2146\"\n      }\n    }\n  }));\n  return options;\n};\n\n_s(useOptions, \"UfleS4trXWGxzhzYTKqqYygmjCE=\");\n\nfunction CheckoutForm(props) {\n  _s2();\n\n  const stripe = useStripe();\n  const elements = useElements();\n  const options = useOptions();\n  const [error, setError] = useState('');\n  const [paymentSuccess, setPaymentSuccess] = useState(false);\n  const [buttonDisabled, setButtonDisable] = useState(false);\n\n  const handleSubmit = event => {\n    event.preventDefault();\n    setButtonDisable(true);\n    stripe.createPaymentMethod({\n      type: \"card\",\n      card: elements.getElement(CardNumberElement)\n    }).then((res, err) => {\n      if (res && res.paymentMethod) {\n        try {\n          API.post('Payment_Post', {\n            amount: props.planDetail.calculated_price,\n            currencyType: props.planDetail.currencyType,\n            id: res.paymentMethod.id,\n            planId: props.planDetail.id\n          }, '', result => {\n            handleServerResponse(result.data);\n          });\n        } catch (error) {\n          setError(error);\n          setButtonDisable(false);\n          console.log(error);\n        }\n      } else {\n        setError(error);\n        setButtonDisable(false);\n        console.log(err);\n      }\n    });\n  };\n\n  const handleServerResponse = response => {\n    if (response.error) {\n      setError(error.message);\n      setButtonDisable(false); // Show error from server on payment form\n    } else if (response.requires_action) {\n      // Use Stripe.js to handle the required card action\n      stripe.handleCardAction(response.payment_intent_client_secret).then((res, err) => {\n        if (err) {\n          console.log(err);\n          setButtonDisable(false);\n          setError(err); // Show error from Stripe.js in payment form\n        } else {\n          try {\n            API.post('Payment_Post', {\n              payment_intent_id: res.paymentIntent.id\n            }, '', result => {\n              handleServerResponse(result.data);\n            });\n          } catch (error) {\n            setError(error);\n            setButtonDisable(false);\n            console.log(error);\n          }\n        }\n      });\n    } else {\n      console.log(response);\n      setError(false);\n      setButtonDisable(false);\n      let userDetail = getLocalStorageItem('userDetail');\n      userDetail.user['subscription'] = response.planDetail.subscription;\n      setLocalStorageItem('userDetail', userDetail);\n      setLocalStorageItem('expires', false);\n      setPaymentSuccess(response);\n      props.auth(); // alert(\"Payment Success\" + JSON.stringify(response))\n    }\n  };\n\n  if (paymentSuccess) {\n    return /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"col-6 shadow align-items-center mt-5 mb-5 pt-5\",\n      children: [/*#__PURE__*/_jsxDEV(\"h2\", {\n        style: {\n          color: 'green'\n        },\n        children: \"Your payment is successfull\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 135,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n        children: [\" Transaction ID : \", paymentSuccess.intent.id]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 136,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n        children: \"Now enjoy your subscription\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 137,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 134,\n      columnNumber: 7\n    }, this);\n  }\n\n  console.log(props);\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"col-6 shadow align-items-center mt-5 mb-5 pt-5\",\n    children: /*#__PURE__*/_jsxDEV(\"form\", {\n      onSubmit: handleSubmit,\n      children: [/*#__PURE__*/_jsxDEV(\"label\", {\n        children: \"Card number\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 146,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        id: \"card-element\",\n        className: \"form-control form-control-payment\",\n        children: /*#__PURE__*/_jsxDEV(CardNumberElement, {\n          className: \"test\",\n          options: options,\n          onReady: () => {\n            console.log(\"CardNumberElement [ready]\");\n          },\n          onChange: event => {\n            console.log(\"CardNumberElement [change]\", event);\n          },\n          onBlur: () => {\n            console.log(\"CardNumberElement [blur]\");\n          },\n          onFocus: () => {\n            console.log(\"CardNumberElement [focus]\");\n          }\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 151,\n          columnNumber: 13\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 149,\n        columnNumber: 11\n      }, this), /*#__PURE__*/_jsxDEV(\"label\", {\n        children: \"Expiration date\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 168,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        id: \"card-element\",\n        className: \"form-control form-control-payment\",\n        children: /*#__PURE__*/_jsxDEV(CardExpiryElement, {\n          options: options,\n          onReady: () => {\n            console.log(\"CardNumberElement [ready]\");\n          },\n          onChange: event => {\n            console.log(\"CardNumberElement [change]\", event);\n          },\n          onBlur: () => {\n            console.log(\"CardNumberElement [blur]\");\n          },\n          onFocus: () => {\n            console.log(\"CardNumberElement [focus]\");\n          }\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 173,\n          columnNumber: 13\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 171,\n        columnNumber: 11\n      }, this), /*#__PURE__*/_jsxDEV(\"label\", {\n        children: \"CVC\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 189,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        id: \"card-element\",\n        className: \"form-control form-control-payment\",\n        children: /*#__PURE__*/_jsxDEV(CardCvcElement, {\n          options: options,\n          onReady: () => {\n            console.log(\"CardNumberElement [ready]\");\n          },\n          onChange: event => {\n            console.log(\"CardNumberElement [change]\", event);\n          },\n          onBlur: () => {\n            console.log(\"CardNumberElement [blur]\");\n          },\n          onFocus: () => {\n            console.log(\"CardNumberElement [focus]\");\n          }\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 194,\n          columnNumber: 11\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 192,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"label\", {}, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 210,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        id: \"card-element\",\n        className: \"col-md-12 form-control-payment\",\n        children: [/*#__PURE__*/_jsxDEV(\"button\", {\n          style: {\n            \"padding\": \"9px\"\n          },\n          className: `form-control btn btn-primary ${buttonDisabled ? 'btnDisabled' : \" \"}`,\n          type: \"submit\",\n          disabled: buttonDisabled || !stripe,\n          children: [\"Pay \", props.planDetail.currencyType, \" \", props.planDetail.calculated_price]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 213,\n          columnNumber: 11\n        }, this), error && /*#__PURE__*/_jsxDEV(\"span\", {\n          children: error\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 216,\n          columnNumber: 21\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 211,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 145,\n      columnNumber: 5\n    }, this)\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 143,\n    columnNumber: 5\n  }, this);\n}\n\n_s2(CheckoutForm, \"prMjAqB0gS2d9ydBCZjERH+KPe0=\", false, function () {\n  return [useStripe, useElements, useOptions];\n});\n\n_c = CheckoutForm;\n;\n\nconst mapStateToProps = state => ({\n  userDetail: state.user.userDetail\n});\n\nconst mapDispatchToProps = {\n  auth\n};\nexport default connect(mapStateToProps, mapDispatchToProps)(CheckoutForm);\n\nvar _c;\n\n$RefreshReg$(_c, \"CheckoutForm\");","map":{"version":3,"sources":["/home/dbws/projects/resume-maker/resume-react-ui/src/components/pages/price/checkoutForm.js"],"names":["React","useState","useEffect","useMemo","API","connect","useStripe","useElements","CardNumberElement","CardCvcElement","CardExpiryElement","setLocalStorageItem","getLocalStorageItem","auth","useOptions","options","style","base","color","letterSpacing","fontFamily","invalid","CheckoutForm","props","stripe","elements","error","setError","paymentSuccess","setPaymentSuccess","buttonDisabled","setButtonDisable","handleSubmit","event","preventDefault","createPaymentMethod","type","card","getElement","then","res","err","paymentMethod","post","amount","planDetail","calculated_price","currencyType","id","planId","result","handleServerResponse","data","console","log","response","message","requires_action","handleCardAction","payment_intent_client_secret","payment_intent_id","paymentIntent","userDetail","user","subscription","intent","mapStateToProps","state","mapDispatchToProps"],"mappings":"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","sourcesContent":["import React , {useState, useEffect , useMemo} from \"react\";\n// import { CardElement, useStripe, useElements } from \"@stripe/react-stripe-js\";\nimport API from \"../../../API/index\";\nimport { connect } from \"react-redux\";\n\nimport {\n  useStripe,\n  useElements,\n  CardNumberElement,\n  CardCvcElement,\n  CardExpiryElement\n} from \"@stripe/react-stripe-js\";\nimport { setLocalStorageItem , getLocalStorageItem } from \"../../../utils/globals\";\nimport { auth } from \"../../../actions/user\";\n\nconst useOptions = () => {\n  // const fontSize = useResponsiveFontSize();\n  const options = useMemo(\n    () => ({\n      style: {\n        base: {\n          // fontSize,\n          color: \"#424770\",\n          letterSpacing: \"0.025em\",\n          fontFamily: \"Source Code Pro, monospace\",\n          \"::placeholder\": {\n            color: \"#aab7c4\"\n          }\n        },\n        invalid: {\n          color: \"#9e2146\"\n        }\n      }\n    })\n  );\n\n  return options;\n};\n\nfunction CheckoutForm(props) {\n  const stripe = useStripe();\n  const elements = useElements();\n  const options = useOptions();\n\n  const [error , setError] = useState('');\n  const [paymentSuccess , setPaymentSuccess] = useState(false);\n  const [buttonDisabled , setButtonDisable] = useState(false);\n  const handleSubmit = (event) => {\n    event.preventDefault();\n    setButtonDisable(true);\n    stripe.createPaymentMethod({\n      type: \"card\",\n      card: elements.getElement(CardNumberElement),\n    }).then((res , err) => {\n        if (res && res.paymentMethod) {\n            try {\n              API.post('Payment_Post',\n                {\n                  amount: props.planDetail.calculated_price,\n                  currencyType: props.planDetail.currencyType,\n                  id: res.paymentMethod.id,\n                  planId : props.planDetail.id\n                }, '',\n                (result) => {\n                  \n                  handleServerResponse(result.data);\n                }\n              )\n            } catch (error) {\n              setError(error);\n              setButtonDisable(false);\n              console.log(error)\n            }\n            \n          } else {\n            setError(error)\n            setButtonDisable(false);\n            console.log(err);\n          }\n    });\n\n    \n  };\n\n  const handleServerResponse = (response) => {\n    if (response.error) {\n      setError(error.message)\n      setButtonDisable(false);\n      // Show error from server on payment form\n    } else if (response.requires_action) {\n      // Use Stripe.js to handle the required card action\n        stripe.handleCardAction(response.payment_intent_client_secret).then((res , err) => {\n\n          if (err) {\n            console.log(err);\n            setButtonDisable(false);\n            setError(err);\n            // Show error from Stripe.js in payment form\n          } else {\n            \n            try {\n              API.post('Payment_Post',\n                {\n                  payment_intent_id : res.paymentIntent.id\n                }, '',\n                (result) => {\n                  handleServerResponse(result.data);\n                }\n              )\n            } catch (error) {\n              setError(error)\n              setButtonDisable(false);\n              console.log(error)\n            }\n          }\n        });\n  \n    } else {\n      console.log(response);\n      setError(false);\n      setButtonDisable(false);\n      let userDetail = getLocalStorageItem('userDetail');\n      userDetail.user['subscription'] = response.planDetail.subscription;\n      setLocalStorageItem('userDetail' , userDetail );\n      setLocalStorageItem('expires' , false)  \n      setPaymentSuccess(response);\n      props.auth()\n\n      // alert(\"Payment Success\" + JSON.stringify(response))\n    }\n  }\n  if(paymentSuccess){\n    return (\n      <div className=\"col-6 shadow align-items-center mt-5 mb-5 pt-5\">\n        <h2 style={{color : 'green'}}>Your payment is successfull</h2>\n        <span> Transaction ID : {paymentSuccess.intent.id}</span>\n        <p>Now enjoy your subscription</p>\n      </div>\n    )\n  }\n  console.log(props)\n  return (\n    <div className=\"col-6 shadow align-items-center mt-5 mb-5 pt-5\">\n\n    <form onSubmit={handleSubmit}>\n        <label>\n          Card number\n          </label>\n          <div id=\"card-element\" className=\"form-control form-control-payment\">\n\n            <CardNumberElement\n              className=\"test\"\n              options={options}\n              onReady={() => {\n                console.log(\"CardNumberElement [ready]\");\n              }}\n              onChange={event => {\n                console.log(\"CardNumberElement [change]\", event);\n              }}\n              onBlur={() => {\n                console.log(\"CardNumberElement [blur]\");\n              }}\n              onFocus={() => {\n                console.log(\"CardNumberElement [focus]\");\n              }}\n            />\n          </div>\n        <label>\n          Expiration date\n          </label>\n          <div id=\"card-element\" className=\"form-control form-control-payment\">\n\n            <CardExpiryElement\n              options={options}\n              onReady={() => {\n                console.log(\"CardNumberElement [ready]\");\n              }}\n              onChange={event => {\n                console.log(\"CardNumberElement [change]\", event);\n              }}\n              onBlur={() => {\n                console.log(\"CardNumberElement [blur]\");\n              }}\n              onFocus={() => {\n                console.log(\"CardNumberElement [focus]\");\n              }}\n            />\n        </div>\n        <label>\n          CVC\n        </label>\n        <div id=\"card-element\" className=\"form-control form-control-payment\">\n\n          <CardCvcElement\n            options={options}\n            onReady={() => {\n              console.log(\"CardNumberElement [ready]\");\n            }}\n            onChange={event => {\n              console.log(\"CardNumberElement [change]\", event);\n            }}\n            onBlur={() => {\n              console.log(\"CardNumberElement [blur]\");\n            }}\n            onFocus={() => {\n              console.log(\"CardNumberElement [focus]\");\n            }}\n          />\n        </div>\n        <label></label>\n        <div id=\"card-element\" className=\"col-md-12 form-control-payment\">\n\n          <button style={{\"padding\" : \"9px\"}} className={`form-control btn btn-primary ${buttonDisabled ? 'btnDisabled' : \" \"}`} type=\"submit\" disabled={buttonDisabled || !stripe}>\n            Pay {props.planDetail.currencyType} {props.planDetail.calculated_price}\n          </button>\n          {error && <span>{error}</span>}\n        </div>\n    </form>\n    </div>\n    \n  );\n};\n\nconst mapStateToProps = ( state ) => ( {\n  userDetail: state.user.userDetail\n} );\n\nconst mapDispatchToProps = {\n  auth,\n};\n\nexport default connect( mapStateToProps, mapDispatchToProps )( CheckoutForm );\n"]},"metadata":{},"sourceType":"module"}